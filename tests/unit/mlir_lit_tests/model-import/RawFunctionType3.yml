#
# This file is distributed under the MIT License. See LICENSE.md for details.
#
# RUN: set -euo pipefail; TEMP=$(mktemp -p .); %revngpipe import-all-clift-types %s <(tar -czT /dev/null) "$TEMP"; %revngcliftopt "$TEMP" | FileCheck %s; rm -f "$TEMP"

Architecture: x86_64
TypeDefinitions:
  - ID: 201
    Kind: StructDefinition
    CustomName: my_struct
    Size: 8
    Fields:
      - Offset: 0
        Type:
          Kind: PrimitiveType
          PrimitiveKind: Unsigned
          Size: 8

    # CHECK: #register_set_1002$def = #clift.struct<
    # CHECK:   unique_handle = "/register-set-type/1002"
    # CHECK:   name = "register_set_1002"
    # CHECK:   size = 16
    # CHECK:   fields = [
    # CHECK:     <
    # CHECK:       offset = 0
    # CHECK:       type = !clift.primitive<
    # CHECK:         unsigned 8
    # CHECK:       >
    # CHECK:     >
    # CHECK:     <
    # CHECK:       offset = 8
    # CHECK:       type = !clift.pointer<
    # CHECK:         pointee_type = !clift.primitive<
    # CHECK:           unsigned 8
    # CHECK:         >
    # CHECK:         pointer_size = 8
    # CHECK:       >
    # CHECK:     >
    # CHECK:   ]
    # CHECK: >
    # CHECK: !register_set_1002_ = !clift.defined<#register_set_1002$def>

    # CHECK: #my_function3$def = #clift.function<
    # CHECK:   unique_handle = "/model-type/1002"
    # CHECK:   name = "my_function3"
    # CHECK:   return_type = !register_set_1002_,
    # CHECK:   argument_types = [
    # CHECK:     !uint64_t
    # CHECK:     !clift.pointer<pointee_type = !uint64_t, pointer_size = 8>
    # CHECK:     !clift.pointer<pointee_type = !my_struct, pointer_size = 8>
    # CHECK:   ]
    # CHECK: >
    # CHECK: !my_function3_ = !clift.defined<#my_function3$def>
  - ID: 1002
    Kind: RawFunctionDefinition
    CustomName: "my_function3"
    Architecture: x86_64
    Arguments:
      - Location: rax_x86_64
        Type:
          Kind: PrimitiveType
          PrimitiveKind: Unsigned
          Size: 8
      - Location: rbx_x86_64
        Type:
          Kind: PointerType
          PointerSize: 8
          PointeeType:
            Kind: PrimitiveType
            PrimitiveKind: Unsigned
            Size: 8
    ReturnValues:
      - Location: rcx_x86_64
        Type:
          Kind: PrimitiveType
          PrimitiveKind: Unsigned
          Size: 8
      - Location: rdx_x86_64
        Type:
          Kind: PointerType
          PointerSize: 8
          PointeeType:
            Kind: PrimitiveType
            PrimitiveKind: Unsigned
            Size: 8
    PreservedRegisters:
      - rdi_x86_64
      - rsi_x86_64
    FinalStackOffset: 0
    StackArgumentsType:
      Kind: DefinedType
      Definition: "/TypeDefinitions/201-StructDefinition"
